+++
title = "This Week In Veloren 27"
description = ""

date = 2019-08-05
weight = 0
slug = "devblog-27"
+++

Thanks to all of the contributors this week, @Pfauenauge, @Qutrin, @xacrimon, @tommywatson, @Muqito, @Vechro, @Nero, @Imbris, @sheldon_knuth, @Timo, and @Zesterer!

## Saturday Screenshot Winner

Thanks to @Pfauenauge for this week's screenshot. We're excited to see what comes out next week!

<img src="https://cdn.discordapp.com/attachments/541307708146581519/605415582472470659/ZDYfRCvBZ5szsQ83Nbd8CgRfwrgV2z8TCI78oJ2stQs295n9n5Vm6jxei7o6ep4fiR7gOH5X60hdv8aeWExTY4tGyYjEZPPyBkmB.png"/>

> Experimenting with new objects and lighting to make this cozy cabin!

# Programming

## 

<img src="https://cdn.discordapp.com/attachments/467861297279533066/606133365711568907/unknown.png">

SM (lighting calculations in the fragment shader) are running at 54% efficiency, which is alright for a post-processor, but for vertex processing it shouldn't be the top performer
VRAM and VAF (vertex attribute fetch) is running at around 16% efficiency.
Shaders are running for 76% of the time, 24% of the time they are waiting on memory access (Short Scoreboard)
You've got no texture stalling (long scoreboard) as there's no textures in the fragment shader. Woohoo!
722000 triangles (2.1 million vertices) are being rendered. Need to combine faces or have an LoD system to improve this

<img src="https://cdn.discordapp.com/attachments/467861297279533066/606135020632932352/unknown.png">

Viewport culling (VPC) is being overworked, need to cull the chunks that are outside the screen
4.6 million triangles (13.9 million vertices) are being rendered every frame. That's 106mb of data loading from VRAM
1494 Wait for Idle Count - holy crap, my game has 3 every frame. How are you rendering the chunks? glDrawArrays? Wait for Idle is caused when there's other GPU commands being sent in between draw calls.
Graphics/Compute Idle has risen from 0.37% to 25%. The entire GPU pipeline is inactive for 25% of the time (waiting for a command from the CPU to arrive). Somethings definitely happening between draw calls. Note this was profiled after all the chunks have been generated and CPU usage was around 7%
SM efficiency has reduced by over a half (21.5%), meaning the shader is either waiting for memory access or waiting for commands to run


Chunks are seemingly rendered in a random order, and to a framebuffer with RGBA_16F format. Colour read/write operation is at 13% efficiency, that will boost up quite a bit if you render to a RGB_8I framebuffer (3 bytes, red green blue). 24 outgoing bits per pixel rather than 64
Rendering to 3 render targets in my game runs 3x slower than rendering to one, so that's an easy and quick fix

Stencil testing is enabled the entire time but nothing's drawn to the stencil buffer. Change the depth attachment from GL_DEPTH24_STENCIL8 to just GL_DEPTH24